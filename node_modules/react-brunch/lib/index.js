// Generated by CoffeeScript 1.7.1
var ReactCompiler, transform, visitors;

visitors = require('react-tools/vendor/fbtransform/visitors');

transform = require('jstransform').transform;

module.exports = ReactCompiler = (function() {
  ReactCompiler.prototype.brunchPlugin = true;

  ReactCompiler.prototype.type = 'javascript';

  ReactCompiler.prototype.extension = 'jsx';

  ReactCompiler.prototype.pattern = /\.jsx/;

  function ReactCompiler(config) {
    var _ref, _ref1, _ref2, _ref3, _ref4, _ref5;
    this.config = config;
    this.includeHeader = ((_ref = this.config) != null ? (_ref1 = _ref.plugins) != null ? (_ref2 = _ref1.react) != null ? _ref2.autoIncludeCommentBlock : void 0 : void 0 : void 0) === true;
    this.harmony = ((_ref3 = this.config) != null ? (_ref4 = _ref3.plugins) != null ? (_ref5 = _ref4.react) != null ? _ref5.harmony : void 0 : void 0 : void 0) === true;
  }

  ReactCompiler.prototype.compile = function(params, callback) {
    var err, output, source, visitorList;
    source = this.includeHeader ? "/** @jsx React.DOM */\n" + params.data : params.data;
    visitorList = this.harmony ? visitors.getAllVisitors() : visitors.transformVisitors.react;
    try {
      output = transform(visitorList, source).code;
    } catch (_error) {
      err = _error;
      console.log("ERROR", err);
      return callback(err.toString());
    }
    return callback(null, {
      data: output
    });
  };

  return ReactCompiler;

})();
